# nginx/default.conf
server {
    listen 80;
    server_name localhost;

    root /var/www/html/public; # Optional, mainly if you have static assets here

    # --- Existing Services ---
    location /courses {
        rewrite ^/courses(.*)$ $1 break;
        proxy_pass http://course-service:9000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # --- New Services ---

    # Proxy to Student Service
    location /students {
        rewrite ^/students(.*)$ $1 break;
        proxy_pass http://student-service:9000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Proxy to Teacher Service
    location /teachers {
        rewrite ^/teachers(.*)$ $1 break;
        proxy_pass http://teacher-service:9000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Proxy to Enrollment Service
    location /enrollments {
        rewrite ^/enrollments(.*)$ $1 break;
        proxy_pass http://enrollment-service:9000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Optional: Catch-all for other PHP files if needed (uncommon for microservices setup)
    # location ~ \.php$ {
    #     fastcgi_pass php-fpm:9000;
    #     fastcgi_index index.php;
    #     fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    #     include fastcgi_params;
    # }
}